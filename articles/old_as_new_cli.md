---
title: "なうい環境を古典的スタックで実現する"
emoji: "💻"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["CLI", "tmux", "vim", "ClaudeCode", "Moshi"]
published: true
---
みなさんこんにちは。最近はAIの発展に伴い、さまざまなツールが乱立し始めてますね。

特にこれはCLIツールに顕著であると思います。Claude CodeやCodexの発展に伴い、それを並列でたくさん動かしたくなる→CLIに最も進化が素早く届くので、今までCLIツールに慣れ親しんでいなかった層にCLIツールの必要性が発生したり、GUIのメモリ使用量がもったいなくなる、あたりでしょうか。

例にもれず自分も直近GUI離れが加速した（※ といってもCLIがベストとも思ってないので適宜VS Codeなどは使っています。この記事もVS Codeで書いています。）ので自分がどのように「なうい環境」を実現していったのかまとめてみようと思います。

## シェル環境

まずシェル環境ですが、Terminal.app + fishという構成になっています。Ghosttyなどが最近だと話題ですが、Alacritty、iTerm2などを通ってきた結果、デフォルトでできるのが一番という結論に至りTerminal.appを使うようになりました。

fishに関してはzshだとカスタマイズが重いけど、fishぐらいならちょうどいいみたいな感覚でずっと使っているのでそのまま活用しています。

## CLIエディタ

これはvimです。Neovimではありません。元々vimをだいぶカスタマイズしていたのでそのまま活用しました。
その際に、元々使っていたdein.vimが作者の方によってメンテナンスモードに入っていたのでdpp.vimに移行しました。

ここからが今回の記事の肝なのですが、昔のvimrc、プラグインの移行など当然かなりの難易度になる作業です。普通のプログラミングよりも難しいかもしれません。
そこで自分はこれをClaude Codeに任せることにしました。内容としてはvimrcのリファクタとコメントを適切につける改修、プラグインの管理方法の移管、vimrcリポジトリを作る、です。

これらをClaude Codeを通してやることで、設定の難易度を大きく下げつつ、理想のvimに仕上げることができました。

このリポジトリに上がっています。

https://github.com/touyou/myvimrc

あえて昔からあったdotfilesのリポジトリとは別で作成しました。

## ターミナルマルチプレクサ

こちらはtmuxです。現在はZellijが話題になっているかと思いますが、その比較記事を読んだ際、自分のようなライトな使い方であればこのZellijのいい点をtmuxで真似すればいいのでは...？と思い至りました。

どうするか？
もうおわかりかと思いますがこれもClaude Codeに任せることにしました。

vimrcと同じようにtmux.confを編集させます。取り入れた一番のポイントはショートカットキーをチートシートのように表示しておくことです。複雑なことは不要なのでこれだけ行いました。
そしてこれも同様にリポジトリ管理できるようにしています。それがこちら。

https://github.com/touyou/mytmux

これによってこのような表示が実現できます。

![](/images/old_as_new_cli/image.png)

## iPhoneからの外部接続

外部接続については直近はやりのMoshi + mosh + Tailscaleを採用しています。

諸々試してみた結果、Moshiが一番使いやすくインターフェイスもいいという結果に至ったからです。

今までの傾向を見るとmoshではなくSSHを使うのでは？となるところかもしれませんが、ここはmosh必須です。
みなさん真似をするのが当たり前すぎて比較していませんが、実はmoshを使わないとCJK文字、すなわち日本語がiPhone側で表示できません。これはエンコードなどをいくらいじっても無理です。なので**moshのインストールは必須**です。

またtmuxとの統合がかなり行き届いているのですが、一方で注意がいくつかあります。

- tmuxのセッション名には日本語を使わない ... moshで日本語表示ができてもMoshiのアプリ側は日本語の受け入れに対応していないため、日本語がアンダーバーに置き換えられた状態でセッションにアタッチしようとしてしまいます
- SSH接続の時にはtmuxを自動起動しないように ... Moshiが自動で`tmux attach-session -t 'hoge'`を実行しようとするので処理がぶつかります。ただPCの時は自動起動が便利なことは事実なので自分は次のように調整しました。

```sh:config.fish
if status is-interactive
    # tmux 自動起動（多重起動防止）
    if not set -q TMUX; and not set -q SSH_CONNECTION
        exec tmux
    end
end
```

## まとめ

というわけで自分がいかにして古典的なスタックでなうい環境を構築したかについて簡単にですが紹介させていただきました。
デフォルトで色々やってくれる、も便利ですが、AI時代の今、設定ファイルはいくらでもAIに作らせることができますし、古典的であればあるほどWeb検索などがなくてもAIが知っているというのもでかいです。

ぜひみなさんも一度vimやtmuxといったオリジンに立ち返ってAIとともに自分なりの環境を作ってみるのはいかがでしょうか？
